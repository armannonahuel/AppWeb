/*! OpenLibra - v1.0 - 2016-10-19 */

!function(a){"use strict";a.fn.fileinputLocales={};var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$;b=function(a){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===a)return new RegExp("msie\\s"+a,"i").test(navigator.userAgent);var b,c=document.createElement("div");return c.innerHTML="<!--[if IE "+a+"]> <i></i> <![endif]-->",b=c.getElementsByTagName("i").length,document.body.appendChild(c),c.parentNode.removeChild(c),b},c=function(){return new RegExp("Edge/[0-9]+","i").test(navigator.userAgent)},d=function(a,b,c,d){var e=d?b:b+".fileinput";a.off(e).on(e,c)},e={data:{},init:function(a){var b=a.initialPreview,c=a.id;b.length>0&&!T(b)&&(b=b.split(a.initialPreviewDelimiter)),e.data[c]={content:b,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags,delimiter:a.initialPreviewDelimiter,template:a.previewGenericTemplate,msg:function(b){return a.getMsgSelected(b)},initId:a.previewInitId,footer:a.getLayoutTemplate("footer").replace(/\{progress}/g,a.renderThumbProgress()),isDelete:a.initialPreviewShowDelete,caption:a.initialCaption,actions:function(b,c,d,e,f){return a.renderFileActions(b,c,d,e,f)}}},fetch:function(a){return e.data[a].content.filter(function(a){return null!==a})},count:function(a,b){return e.data[a]&&e.data[a].content?b?e.data[a].content.length:e.fetch(a).length:0},get:function(b,c,d){var f,g,h="init_"+c,i=e.data[b],j=i.config[c],k=i.initId+"-"+h,l=" file-preview-initial";return d=void 0===d?!0:d,null===i.content[c]?"":(S(j)||S(j.frameClass)||(l+=" "+j.frameClass),f=i.template.replace(/\{previewId}/g,k).replace(/\{frameClass}/g,l).replace(/\{fileindex}/g,h).replace(/\{content}/g,i.content[c]).replace(/\{footer}/g,e.footer(b,c,d)),i.tags.length&&i.tags[c]&&(f=Y(f,i.tags[c])),S(j)||S(j.frameAttr)||(g=a(document.createElement("div")).html(f),g.find(".file-preview-initial").attr(j.frameAttr),f=g.html(),g.remove()),f)},add:function(b,c,d,f,g){var h,i=a.extend(!0,{},e.data[b]);return T(c)||(c=c.split(i.delimiter)),g?(h=i.content.push(c)-1,i.config[h]=d,i.tags[h]=f):(h=c.length,i.content=c,i.config=d,i.tags=f),e.data[b]=i,h},set:function(b,c,d,f,g){var h,i,j=a.extend(!0,{},e.data[b]);if(c&&c.length&&(T(c)||(c=c.split(j.delimiter)),i=c.filter(function(a){return null!==a}),i.length)){if(void 0===j.content&&(j.content=[]),void 0===j.config&&(j.config=[]),void 0===j.tags&&(j.tags=[]),g){for(h=0;h<c.length;h++)c[h]&&j.content.push(c[h]);for(h=0;h<d.length;h++)d[h]&&j.config.push(d[h]);for(h=0;h<f.length;h++)f[h]&&j.tags.push(f[h])}else j.content=c,j.config=d,j.tags=f;e.data[b]=j}},unset:function(a,b){var c=e.count(a);if(c){if(1===c)return e.data[a].content=[],void(e.data[a].config=[]);e.data[a].content[b]=null,e.data[a].config[b]=null}},out:function(a){var b,c="",d=e.data[a],f=e.count(a,!0);if(0===f)return{content:"",caption:""};for(var g=0;f>g;g++)c+=e.get(a,g);return b=d.msg(e.count(a)),{content:c,caption:b}},footer:function(a,b,c){var d=e.data[a];if(c=void 0===c?!0:c,0===d.config.length||S(d.config[b]))return"";var f=d.config[b],g=U("caption",f)?f.caption:"",h=U("width",f)?f.width:"auto",i=U("url",f)?f.url:!1,j=U("key",f)?f.key:null,k=i===!1&&c,l=d.isDelete?d.actions(!1,!0,k,i,j):"",m=d.footer.replace(/\{actions}/g,l);return m.replace(/\{caption}/g,g).replace(/\{width}/g,h).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}},f=function(a,b){return b=b||0,"number"==typeof a?a:("string"==typeof a&&(a=parseFloat(a)),isNaN(a)?b:a)},g=function(){return window.File&&window.FileReader},h=function(){var a=document.createElement("div");return!b(9)&&!c()&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},i=function(){return g()&&window.FormData},j=function(a,b){a.removeClass(b).addClass(b)},k='style="width:{width};height:{height};"',l='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',m='<div class="file-preview-other">\n   <span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',n={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default btn",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},o='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',p='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',q='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',s='<div class="close fileinput-remove">&times;</div>\n',r='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',t='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"></div>\n</div>\n',u='<button type="{type}" tabindex="500" title="{title}" class="{css}"{status}>{icon}{label}</button>',v='<a href="{href}" tabindex="500" title="{title}" class="{css}"{status}>{icon}{label}</a>',w='<div tabindex="500" class="{css}"{status}>{icon}{label}</div>',x='<div id="{id}" class="file-preview-detail-modal modal fade" tabindex="-1">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">{heading} <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n           <pre>{body}</pre>\n      </div>\n    </div>\n  </div>\n</div>',y='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',z='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}</div>\n    {progress} {actions}\n</div>',A='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',B='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',C='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',D='<button type="button" class="btn btn-default btn-xs btn-block" title="{zoomTitle}: {caption}" onclick="{dialog}">\n   {zoomInd}\n</button>\n',E='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',F='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object class="file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n       '+m+"\n    </object>\n   {footer}\n</div>",G='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+k+">\n   {footer}\n</div>\n",H='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <pre class="file-preview-text" title="{caption}" '+k+">{data}</pre>\n   {zoom}\n   {footer}\n</div>",I='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+k+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+m+"\n   </video>\n   {footer}\n</div>\n",J='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+k+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+m+"\n   </audio>\n   {footer}\n</div>",K='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+k+'>\n   <object class="file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+l+"       "+m+"\n   </object>\n   {footer}\n</div>\n",L='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+k+'>\n   <object class="file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+l+"         "+m+"\n   </object>\n   {footer}\n</div>",M='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+k+'>\n   <div class="file-preview-other-frame">\n   '+m+'\n   </div>\n   <div class="file-preview-other-footer">{footer}</div>\n</div>',N={main1:o,main2:p,preview:q,close:s,zoom:D,icon:r,caption:t,modal:x,progress:y,footer:z,actions:A,actionDelete:B,actionUpload:C,btnDefault:u,btnLink:v,btnBrowse:w},O={generic:E,html:F,image:G,text:H,video:I,audio:J,flash:K,object:L,other:M},P=["image","html","text","video","audio","flash","object"],Q={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"136px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},R={image:function(a,b){return void 0!==a?a.match("image.*"):b.match(/\.(gif|png|jpe?g)$/i)},html:function(a,b){return void 0!==a?"text/html"===a:b.match(/\.(htm|html)$/i)},text:function(a,b){return void 0!==a&&a.match("text.*")||b.match(/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(a,b){return void 0!==a&&a.match(/\.video\/(ogg|mp4|webm|3gp)$/i)||b.match(/\.(og?|mp4|webm|3gp)$/i)},audio:function(a,b){return void 0!==a&&a.match(/\.audio\/(ogg|mp3|wav)$/i)||b.match(/\.(ogg|mp3|wav)$/i)},flash:function(a,b){return void 0!==a&&"application/x-shockwave-flash"===a||b.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},S=function(b,c){return void 0===b||null===b||0===b.length||c&&""===a.trim(b)},T=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},U=function(a,b){return"object"==typeof b&&a in b},V=function(b,c,d){return S(b)||S(b[c])?d:a(b[c])},W=function(){return Math.round((new Date).getTime()+100*Math.random())},X=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},Y=function(b,c){var d=b;return c?(a.each(c,function(a,b){"function"==typeof b&&(b=b()),d=d.split(a).join(b)}),d):d},Z=window.URL||window.webkitURL,$=function(c,d){var e=this;e.$element=a(c),e.validate()&&(e.isPreviewable=g(),e.isIE9=b(9),e.isIE10=b(10),e.isPreviewable||e.isIE9?(e.init(d),e.listen()):e.$element.removeClass("file-loading"))},$.prototype={constructor:$,validate:function(){var a,b=this;return"file"===b.$element.attr("type")?!0:(a='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',b.$element.after(a),!1)},init:function(b){var c,d=this,g=d.$element;a.each(b,function(a,b){switch(a){case"minFileCount":case"maxFileCount":case"maxFileSize":d[a]=f(b);break;default:d[a]=b}}),d.fileInputCleared=!1,d.fileBatchCompleted=!0,d.isPreviewable||(d.showPreview=!1),d.uploadFileAttr=S(g.attr("name"))?"file_data":g.attr("name"),d.reader=null,d.formdata={},d.clearStack(),d.uploadCount=0,d.uploadStatus={},d.uploadLog=[],d.uploadAsyncCount=0,d.loadedImages=[],d.totalImagesCount=0,d.ajaxRequests=[],d.isError=!1,d.ajaxAborted=!1,d.cancelling=!1,c=d.getLayoutTemplate("progress"),d.progressTemplate=c.replace("{class}",d.progressClass),d.progressCompleteTemplate=c.replace("{class}",d.progressCompleteClass),d.dropZoneEnabled=h()&&d.dropZoneEnabled,d.isDisabled=d.$element.attr("disabled")||d.$element.attr("readonly"),d.isUploadable=i()&&!S(d.uploadUrl),d.slug="function"==typeof b.slugCallback?b.slugCallback:d.slugDefault,d.mainTemplate=d.getLayoutTemplate(d.showCaption?"main1":"main2"),d.captionTemplate=d.getLayoutTemplate("caption"),d.previewGenericTemplate=d.getPreviewTemplate("generic"),d.resizeImage&&(d.maxImageWidth||d.maxImageHeight)&&(d.imageCanvas=document.createElement("canvas"),d.imageCanvasContext=d.imageCanvas.getContext("2d")),S(d.$element.attr("id"))&&d.$element.attr("id",W()),void 0===d.$container?d.$container=d.createContainer():d.refreshContainer(),d.$progress=d.$container.find(".kv-upload-progress"),d.$btnUpload=d.$container.find(".fileinput-upload"),d.$captionContainer=V(b,"elCaptionContainer",d.$container.find(".file-caption")),d.$caption=V(b,"elCaptionText",d.$container.find(".file-caption-name")),d.$previewContainer=V(b,"elPreviewContainer",d.$container.find(".file-preview")),d.$preview=V(b,"elPreviewImage",d.$container.find(".file-preview-thumbnails")),d.$previewStatus=V(b,"elPreviewStatus",d.$container.find(".file-preview-status")),d.$errorContainer=V(b,"elErrorContainer",d.$previewContainer.find(".kv-fileinput-error")),S(d.msgErrorClass)||j(d.$errorContainer,d.msgErrorClass),d.$errorContainer.hide(),d.fileActionSettings=a.extend(n,b.fileActionSettings),d.previewInitId="preview-"+W(),d.id=d.$element.attr("id"),e.init(d),d.initPreview(!0),d.initPreviewDeletes(),d.options=b,d.setFileDropZoneTitle(),d.$element.removeClass("file-loading"),d.$element.attr("disabled")&&d.disable()},parseError:function(b,c,d){var e=this,f=a.trim(c+""),g="."===f.slice(-1)?"":".",h=void 0!==b.responseJSON&&void 0!==b.responseJSON.error?b.responseJSON.error:b.responseText;return e.cancelling&&e.msgUploadAborted&&(f=e.msgUploadAborted),e.showAjaxErrorDetails&&h?(h=a.trim(h.replace(/\n\s*\n/g,"\n")),h=h.length>0?"<pre>"+h+"</pre>":"",f+=g+h):f+=g,e.cancelling=!1,d?"<b>"+d+": </b>"+f:f},raise:function(b,c){var d=this,e=a.Event(b);if(void 0!==c?d.$element.trigger(e,c):d.$element.trigger(e),e.isDefaultPrevented())return!1;if(!e.result)return e.result;switch(b){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:d.ajaxAborted=e.result}return!0},getLayoutTemplate:function(a){var b=this,c=U(a,b.layoutTemplates)?b.layoutTemplates[a]:N[a];return S(b.customLayoutTags)?c:Y(c,b.customLayoutTags)},getPreviewTemplate:function(a){var b=this,c=U(a,b.previewTemplates)?b.previewTemplates[a]:O[a];return S(b.customPreviewTags)?c:Y(c,b.customPreviewTags)},parseFilePreviewIcon:function(b,c){var d,e=this,f=e.previewFileIcon;return c&&c.indexOf(".")>-1&&(d=c.split(".").pop(),e.previewFileIconSettings&&e.previewFileIconSettings[d]&&(f=e.previewFileIconSettings[d]),e.previewFileExtSettings&&a.each(e.previewFileExtSettings,function(a,b){e.previewFileIconSettings[a]&&b(d)&&(f=e.previewFileIconSettings[a])})),b.indexOf("{previewFileIcon}")>-1?b.replace(/\{previewFileIconClass}/g,e.previewFileIconClass).replace(/\{previewFileIcon}/g,f):b},getOutData:function(a,b,c){var d=this;return a=a||{},b=b||{},c=c||d.filestack.slice(0)||{},{form:d.formdata,files:c,filenames:d.filenames,extra:d.getExtraData(),response:b,reader:d.reader,jqXHR:a}},listen:function(){var b=this,c=b.$element,e=b.$captionContainer,f=b.$btnFile,g=c.closest("form"),h=b.$container;d(c,"change",a.proxy(b.change,b)),d(f,"click",function(){b.raise("filebrowse"),b.isError&&!b.isUploadable&&b.clear(),e.focus()}),d(g,"reset",a.proxy(b.reset,b)),d(h.find(".fileinput-remove:not([disabled])"),"click",a.proxy(b.clear,b)),d(h.find(".fileinput-cancel"),"click",a.proxy(b.cancel,b)),b.isUploadable&&b.dropZoneEnabled&&b.showPreview&&b.initDragDrop(),b.isUploadable||d(g,"submit",a.proxy(b.submitForm,b)),d(b.$container.find(".fileinput-upload"),"click",function(c){var d,e=a(this),f=!e.hasClass("disabled")&&S(e.attr("disabled"));return b.isUploadable?(c.preventDefault(),void(f&&b.upload())):void(f&&"submit"!==e.attr("type")&&(d=e.closest("form"),d.length&&d.trigger("submit"),c.preventDefault()))})},submitForm:function(){var a=this,b=a.$element,c=b.get(0).files;return c&&a.minFileCount>0&&a.getFileCount(c.length)<a.minFileCount?(a.noFilesError({}),!1):!a.abort({})},abort:function(b){var c,d=this;return d.ajaxAborted&&"object"==typeof d.ajaxAborted&&void 0!==d.ajaxAborted.message?(c=a.extend(d.getOutData(),b),c.abortData=d.ajaxAborted.data||{},c.abortMessage=d.ajaxAborted.message,d.cancel(),d.setProgress(100),d.showUploadError(d.ajaxAborted.message,c,"filecustomerror"),!0):!1},noFilesError:function(a){var b=this,c=b.minFileCount>1?b.filePlural:b.fileSingle,d=b.msgFilesTooLess.replace("{n}",b.minFileCount).replace("{files}",c),e=b.$errorContainer;b.addError(d),b.isError=!0,b.updateFileDetails(0),e.fadeIn(800),b.raise("fileerror",[a]),b.clearFileInput(),j(b.$container,"has-error")},setProgress:function(a,b){var c=this,d=Math.min(a,100),e=100>d?c.progressTemplate:c.progressCompleteTemplate;b=b||c.$progress,S(e)||b.html(e.replace(/\{percent}/g,d))},lock:function(){var a=this;a.resetErrors(),a.disable(),a.showRemove&&j(a.$container.find(".fileinput-remove"),"hide"),a.showCancel&&a.$container.find(".fileinput-cancel").removeClass("hide"),a.raise("filelock",[a.filestack,a.getExtraData()])},unlock:function(a){var b=this;void 0===a&&(a=!0),b.enable(),b.showCancel&&j(b.$container.find(".fileinput-cancel"),"hide"),b.showRemove&&b.$container.find(".fileinput-remove").removeClass("hide"),a&&b.resetFileStack(),b.raise("fileunlock",[b.filestack,b.getExtraData()])},resetFileStack:function(){var b=this,c=0,d=[],e=[];b.getThumbs().each(function(){var f=a(this),g=f.attr("data-fileindex"),h=b.filestack[g];-1!==g&&(void 0!==h?(d[c]=h,e[c]=b.getFileName(h),f.attr({id:b.previewInitId+"-"+c,"data-fileindex":c}),c++):f.attr({id:"uploaded-"+W(),"data-fileindex":"-1"}))}),b.filestack=d,b.filenames=e},destroy:function(){var a=this,b=a.$container;b.find(".file-drop-zone").off(),a.$element.insertBefore(b).off(".fileinput").removeData(),b.off().remove()},refresh:function(b){var c=this,d=c.$element;b=b?a.extend(c.options,b):c.options,c.destroy(),d.fileinput(b),d.val()&&d.trigger("change.fileinput")},initDragDrop:function(){var b=this,c=b.$container.find(".file-drop-zone"),e="dragenter.fileinput dragover.fileinput drop.fileinput";d(c,"dragenter.fileinput dragover.fileinput",function(c){var d=a.inArray("Files",c.originalEvent.dataTransfer.types)>-1;return c.stopPropagation(),c.preventDefault(),b.isDisabled||!d?(c.originalEvent.dataTransfer.effectAllowed="none",void(c.originalEvent.dataTransfer.dropEffect="none")):void j(a(this),"file-highlighted")},!0),d(c,"dragleave",function(c){c.stopPropagation(),c.preventDefault(),b.isDisabled||a(this).removeClass("file-highlighted")}),d(c,"drop",function(c){c.preventDefault(),b.isDisabled||S(c.originalEvent.dataTransfer.files)||(b.change(c,"dragdrop"),a(this).removeClass("file-highlighted"))}),d(a(document),e,function(a){a.stopPropagation(),a.preventDefault()},!0)},setFileDropZoneTitle:function(){var a=this,b=a.$container.find(".file-drop-zone");b.find("."+a.dropZoneTitleClass).remove(),a.isUploadable&&a.showPreview&&0!==b.length&&!(a.getFileStack().length>0)&&a.dropZoneEnabled&&(0===b.find(".file-preview-frame").length&&S(a.defaultPreviewContent)&&b.prepend('<div class="'+a.dropZoneTitleClass+'">'+a.dropZoneTitle+"</div>"),a.$container.removeClass("file-input-new"),j(a.$container,"file-input-ajax-new"))},errorsExist:function(){var b,c=this;return c.$errorContainer.find("li").length?!0:(b=a(document.createElement("div")).html(c.$errorContainer.html()),b.find("span.kv-error-close").remove(),b.find("ul").remove(),a.trim(b.text()).length?!0:!1)},getMsgSelected:function(a){var b=this,c=1===a?b.fileSingle:b.filePlural;return b.msgSelected.replace("{n}",a).replace("{files}",c)},renderThumbProgress:function(){return'<div class="file-thumb-progress hide">'+this.progressTemplate.replace(/\{percent}/g,"0")+"</div>"},renderFileFooter:function(a,b){var c,d,e=this,f=e.fileActionSettings,g=e.getLayoutTemplate("footer");return e.isUploadable?(c=g.replace(/\{actions}/g,e.renderFileActions(!0,!0,!1,!1,!1)),d=c.replace(/\{caption}/g,a).replace(/\{width}/g,b).replace(/\{progress}/g,e.renderThumbProgress()).replace(/\{indicator}/g,f.indicatorNew).replace(/\{indicatorTitle}/g,f.indicatorNewTitle)):d=g.replace(/\{actions}/g,"").replace(/\{caption}/g,a).replace(/\{progress}/g,"").replace(/\{width}/g,b).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,""),d=Y(d,e.previewThumbTags)},renderFileActions:function(a,b,c,d,e){if(!a&&!b)return"";var f=this,g=d===!1?"":' data-url="'+d+'"',h=e===!1?"":' data-key="'+e+'"',i=f.getLayoutTemplate("actionDelete"),j="",k=f.getLayoutTemplate("actions"),l=f.otherActionButtons.replace(/\{dataKey}/g,h),m=f.fileActionSettings,n=c?m.removeClass+" disabled":m.removeClass;return i=i.replace(/\{removeClass}/g,n).replace(/\{removeIcon}/g,m.removeIcon).replace(/\{removeTitle}/g,m.removeTitle).replace(/\{dataUrl}/g,g).replace(/\{dataKey}/g,h),a&&(j=f.getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,m.uploadClass).replace(/\{uploadIcon}/g,m.uploadIcon).replace(/\{uploadTitle}/g,m.uploadTitle)),k.replace(/\{delete}/g,i).replace(/\{upload}/g,j).replace(/\{other}/g,l)},setThumbStatus:function(a,b){var c=this;if(c.showPreview){var d="indicator"+b,e=d+"Title",f="file-preview-"+b.toLowerCase(),g=a.find(".file-upload-indicator"),h=c.fileActionSettings;a.removeClass("file-preview-success file-preview-error file-preview-loading"),"Error"===b&&a.find(".kv-file-upload").attr("disabled",!0),g.html(h[d]),g.attr("title",h[e]),a.addClass(f)}},clearPreview:function(){var a=this,b=a.$preview.find(a.showUploadedThumbs?".file-preview-frame:not(.file-preview-success)":".file-preview-frame");b.remove(),a.$preview.find(".file-preview-frame").length&&a.showPreview||a.resetUpload(),a.validateDefaultPreview()},initPreview:function(a){var b,c=this,d=c.initialCaption||"";return e.count(c.id)?(b=e.out(c.id),d=a&&c.initialCaption?c.initialCaption:b.caption,c.$preview.html(b.content),c.setCaption(d),void(S(b.content)||c.$container.removeClass("file-input-new"))):(c.clearPreview(),void(a?c.setCaption(d):c.initCaption()))},initPreviewDeletes:function(){var b=this,c=b.deleteExtraData||{},f=function(){var a=b.isUploadable?e.count(b.id):b.$element.get(0).files.length;0!==b.$preview.find(".kv-file-remove").length||a||(b.reset(),b.initialCaption="")};b.$preview.find(".kv-file-remove").each(function(){var g=a(this),h=g.data("url")||b.deleteUrl,i=g.data("key");if(!S(h)&&void 0!==i){var k,l,m,n,o=g.closest(".file-preview-frame"),p=e.data[b.id],q=o.data("fileindex");q=parseInt(q.replace("init_","")),m=S(p.config)&&S(p.config[q])?null:p.config[q],n=S(m)||S(m.extra)?c:m.extra,"function"==typeof n&&(n=n()),l={id:g.attr("id"),key:i,extra:n},k=a.extend({url:h,type:"POST",dataType:"json",data:a.extend({key:i},n),beforeSend:function(a){b.ajaxAborted=!1,b.raise("filepredelete",[i,a,n]),b.ajaxAborted?a.abort():(j(o,"file-uploading"),j(g,"disabled"))},success:function(a,c,d){var h,j;return S(a)||S(a.error)?(e.unset(b.id,q),h=e.count(b.id),j=h>0?b.getMsgSelected(h):"",b.raise("filedeleted",[i,d,n]),b.setCaption(j),o.removeClass("file-uploading").addClass("file-deleted"),void o.fadeOut("slow",function(){b.clearObjects(o),o.remove(),f(),h||0!==b.getFileStack().length||(b.setCaption(""),b.reset())})):(l.jqXHR=d,l.response=a,b.showError(a.error,l,"filedeleteerror"),o.removeClass("file-uploading"),g.removeClass("disabled"),void f())},error:function(a,c,d){var e=b.parseError(a,d);l.jqXHR=a,l.response={},b.showError(e,l,"filedeleteerror"),o.removeClass("file-uploading"),f()}},b.ajaxDeleteSettings),d(g,"click",function(){return b.validateMinCount()?void a.ajax(k):!1})}})},clearObjects:function(b){b.find("video audio").each(function(){this.pause(),a(this).remove()}),b.find("img object div").each(function(){a(this).remove()})},clearFileInput:function(){var b,c,d,e=this,f=e.$element;S(f.val())||(e.isIE9||e.isIE10?(b=f.closest("form"),c=a(document.createElement("form")),d=a(document.createElement("div")),f.before(d),b.length?b.after(c):d.after(c),c.append(f).trigger("reset"),d.before(f).remove(),c.remove()):f.val(""),e.fileInputCleared=!0)},resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:!0},a.uploadCount=0,a.uploadStatus={},a.uploadLog=[],a.uploadAsyncCount=0,a.loadedImages=[],a.totalImagesCount=0,a.$btnUpload.removeAttr("disabled"),a.setProgress(0),j(a.$progress,"hide"),a.resetErrors(!1),a.ajaxAborted=!1,a.ajaxRequests=[],a.resetCanvas()},resetCanvas:function(){var a=this;a.canvas&&a.imageCanvasContext&&a.imageCanvasContext.clearRect(0,0,a.canvas.width,a.canvas.height)},cancel:function(){var b,c=this,d=c.ajaxRequests,e=d.length;if(e>0)for(b=0;e>b;b+=1)c.cancelling=!0,d[b].abort();c.getThumbs().each(function(){var b=a(this),d=b.attr("data-fileindex");b.removeClass("file-uploading"),void 0!==c.filestack[d]&&(b.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),b.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),c.unlock()})},cleanMemory:function(a){var b=a.is("img")?a.attr("src"):a.find("source").attr("src");Z.revokeObjectURL(b)},hasInitialPreview:function(){var a=this;return!a.overwriteInitial&&e.count(a.id)},clear:function(){var b,c=this;c.$btnUpload.removeAttr("disabled"),c.getThumbs().find("video,audio,img").each(function(){c.cleanMemory(a(this))}),c.resetUpload(),c.clearStack(),c.clearFileInput(),c.resetErrors(!0),c.raise("fileclear"),c.hasInitialPreview()?(c.showFileIcon(),c.resetPreview(),c.initPreviewDeletes(),c.$container.removeClass("file-input-new")):(c.getThumbs().each(function(){c.clearObjects(a(this))}),c.isUploadable&&(e.data[c.id]={}),c.$preview.html(""),b=!c.overwriteInitial&&c.initialCaption.length>0?c.initialCaption:"",c.setCaption(b),c.$caption.attr("title",""),j(c.$container,"file-input-new"),c.validateDefaultPreview()),0===c.$container.find(".file-preview-frame").length&&(c.initCaption()||c.$captionContainer.find(".kv-caption-icon").hide()),c.hideFileIcon(),c.raise("filecleared"),c.$captionContainer.focus(),c.setFileDropZoneTitle()},resetPreview:function(){var a,b,c=this;e.count(c.id)?(a=e.out(c.id),c.$preview.html(a.content),b=c.initialCaption?c.initialCaption:a.caption,c.setCaption(b)):(c.clearPreview(),c.initCaption())},clearDefaultPreview:function(){var a=this;a.$preview.find(".file-default-preview").remove()},validateDefaultPreview:function(){var a=this;a.showPreview&&!S(a.defaultPreviewContent)&&(a.$preview.html('<div class="file-default-preview">'+a.defaultPreviewContent+"</div>"),a.$container.removeClass("file-input-new"))},resetPreviewThumbs:function(a){var b,c=this;return a?(c.clearPreview(),void c.clearStack()):void(c.hasInitialPreview()?(b=e.out(c.id),c.$preview.html(b.content),c.setCaption(b.caption),c.initPreviewDeletes()):c.clearPreview())},reset:function(){var a=this;a.resetPreview(),a.$container.find(".fileinput-filename").text(""),a.raise("filereset"),j(a.$container,"file-input-new"),(a.$preview.find(".file-preview-frame").length||a.isUploadable&&a.dropZoneEnabled)&&a.$container.removeClass("file-input-new"),a.setFileDropZoneTitle(),a.clearStack(),a.formdata={}},disable:function(){var a=this;a.isDisabled=!0,a.raise("filedisabled"),a.$element.attr("disabled","disabled"),a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),a.initDragDrop()},enable:function(){var a=this;a.isDisabled=!1,a.raise("fileenabled"),a.$element.removeAttr("disabled"),a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),a.initDragDrop()},getThumbs:function(a){return a=a||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+a)},getExtraData:function(a,b){var c=this,d=c.uploadExtraData;return"function"==typeof c.uploadExtraData&&(d=c.uploadExtraData(a,b)),d},uploadExtra:function(b,c){var d=this,e=d.getExtraData(b,c);0!==e.length&&a.each(e,function(a,b){d.formdata.append(a,b)})},setAsyncUploadStatus:function(b,c,d){var e=this,f=0;e.setProgress(c,a("#"+b).find(".file-thumb-progress")),e.uploadStatus[b]=c,a.each(e.uploadStatus,function(a,b){f+=b}),e.setProgress(Math.ceil(f/d))},initXhr:function(a,b,c){var d=this;return a.upload&&a.upload.addEventListener("progress",function(a){var e=0,f=a.loaded||a.position,g=a.total;a.lengthComputable&&(e=Math.ceil(f/g*100)),b?d.setAsyncUploadStatus(b,e,c):d.setProgress(Math.ceil(e))},!1),a},ajaxSubmit:function(b,c,d,e,f,g){var h,i=this;i.raise("filepreajax",[f,g]),i.uploadExtra(f,g),h=a.extend({xhr:function(){var b=a.ajaxSettings.xhr();return i.initXhr(b,f,i.getFileStack().length)},url:i.uploadUrl,type:"POST",dataType:"json",data:i.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:b,success:c,complete:d,error:e},i.ajaxSettings),i.ajaxRequests.push(a.ajax(h))},initUploadSuccess:function(b,c,d){var f,g,h,i,j,k,l,m,n=this;n.showPreview&&"object"==typeof b&&!a.isEmptyObject(b)&&void 0!==b.initialPreview&&b.initialPreview.length>0&&(n.hasInitData=!0,j=b.initialPreview||[],k=b.initialPreviewConfig||[],l=b.initialPreviewThumbTags||[],f=void 0===b.append||b.append?!0:!1,n.overwriteInitial=!1,void 0!==c?d?(m=c.attr("data-fileindex"),n.uploadCache.content[m]=j[0],n.uploadCache.config[m]=k[0],n.uploadCache.tags[m]=l[0],n.uploadCache.append=f):(h=e.add(n.id,j,k[0],l[0],f),g=e.get(n.id,h,!1),i=a(g).hide(),c.after(i).fadeOut("slow",function(){i.fadeIn("slow").css("display:inline-block"),n.initPreviewDeletes(),n.clearFileInput(),c.remove()})):(e.set(n.id,j,k,l,f),n.initPreview(),n.initPreviewDeletes()))},initSuccessThumbs:function(){var b=this;b.showPreview&&b.getThumbs(".file-preview-success").each(function(){var c=a(this),e=c.find(".kv-file-remove");e.removeAttr("disabled"),d(e,"click",function(){var a=b.raise("filesuccessremove",[c.attr("id"),c.data("fileindex")]);b.cleanMemory(c),a!==!1&&c.fadeOut("slow",function(){c.remove(),b.$preview.find(".file-preview-frame").length||b.reset()})})})},checkAsyncComplete:function(){var b,c,d=this;for(c=0;c<d.filestack.length;c++)if(d.filestack[c]&&(b=d.previewInitId+"-"+c,-1===a.inArray(b,d.uploadLog)))return!1;return d.uploadAsyncCount===d.uploadLog.length},uploadSingle:function(b,c,d){var f,g,h,i,k,l,m,n,o,p,q=this,r=q.getFileStack().length,s=new FormData,t=q.previewInitId+"-"+b,u=q.filestack.length>0||!a.isEmptyObject(q.uploadExtraData),v={id:t,index:b};q.formdata=s,q.showPreview&&(g=a("#"+t+":not(.file-preview-initial)"),i=g.find(".kv-file-upload"),k=g.find(".kv-file-remove"),a("#"+t).find(".file-thumb-progress").removeClass("hide")),0===r||!u||i&&i.hasClass("disabled")||q.abort(v)||(p=function(a,b){q.updateStack(a,void 0),q.uploadLog.push(b),q.checkAsyncComplete()&&(q.fileBatchCompleted=!0)},h=function(){q.fileBatchCompleted&&setTimeout(function(){q.showPreview&&(e.set(q.id,q.uploadCache.content,q.uploadCache.config,q.uploadCache.tags,q.uploadCache.append),q.hasInitData&&(q.initPreview(),q.initPreviewDeletes())),q.unlock(),q.clearFileInput(),q.raise("filebatchuploadcomplete",[q.filestack,q.getExtraData()]),q.uploadCount=0,q.uploadStatus={},q.uploadLog=[],q.setProgress(100)
},100)},l=function(c){f=q.getOutData(c),q.fileBatchCompleted=!1,q.showPreview&&(g.hasClass("file-preview-success")||(q.setThumbStatus(g,"Loading"),j(g,"file-uploading")),i.attr("disabled",!0),k.attr("disabled",!0)),d||q.lock(),q.raise("filepreupload",[f,t,b]),v=a.extend(v,f),q.abort(v)&&(c.abort(),q.setProgress(100))},m=function(c,e,h){f=q.getOutData(h,c),v=a.extend(v,f),setTimeout(function(){S(c)||S(c.error)?(q.showPreview&&(q.setThumbStatus(g,"Success"),i.hide(),q.initUploadSuccess(c,g,d)),q.raise("fileuploaded",[f,t,b]),d?p(b,t):(q.resetFileStack(),q.updateStack(b,void 0))):(q.setThumbStatus(g,"Error"),q.showUploadError(c.error,v),d&&p(b,t))},100)},n=function(){setTimeout(function(){q.showPreview&&(i.removeAttr("disabled"),k.removeAttr("disabled"),g.removeClass("file-uploading")),d?h():q.unlock(!1),q.initSuccessThumbs()},100)},o=function(e,f,h){var i=q.parseError(e,h,d?c[b].name:null);setTimeout(function(){d&&p(b,t),q.uploadStatus[t]=100,q.setThumbStatus(g,"Error"),v=a.extend(v,q.getOutData(e)),q.showUploadError(i,v)},100)},s.append(q.uploadFileAttr,c[b],q.filenames[b]),s.append("file_id",b),q.ajaxSubmit(l,m,n,o,t,b))},uploadBatch:function(){var b,c,d,e,f,g=this,h=g.filestack,i=h.length,k={},l=g.filestack.length>0||!a.isEmptyObject(g.uploadExtraData);g.formdata=new FormData,0!==i&&l&&!g.abort(k)&&(b=function(){a.each(h,function(a){g.updateStack(a,void 0)}),g.clearFileInput()},c=function(b){g.lock();var c=g.getOutData(b);g.showPreview&&g.getThumbs().each(function(){var b=a(this),c=b.find(".kv-file-upload"),d=b.find(".kv-file-remove");b.hasClass("file-preview-success")||(g.setThumbStatus(b,"Loading"),j(b,"file-uploading")),c.attr("disabled",!0),d.attr("disabled",!0)}),g.raise("filebatchpreupload",[c]),g.abort(c)&&(b.abort(),g.setProgress(100))},d=function(c,d,e){var f=g.getOutData(e,c),h=g.getThumbs(),i=0,j=S(c)||S(c.errorkeys)?[]:c.errorkeys;S(c)||S(c.error)?(g.raise("filebatchuploadsuccess",[f]),b(),g.showPreview?(h.each(function(){var b=a(this),c=b.find(".kv-file-upload");b.find(".kv-file-upload").hide(),g.setThumbStatus(b,"Success"),b.removeClass("file-uploading"),c.removeAttr("disabled")}),g.initUploadSuccess(c)):g.reset()):(g.showPreview&&(h.each(function(){var b=a(this),c=b.find(".kv-file-remove"),d=b.find(".kv-file-upload");return b.removeClass("file-uploading"),d.removeAttr("disabled"),c.removeAttr("disabled"),0===j.length?void g.setThumbStatus(b,"Error"):(-1!==a.inArray(i,j)?g.setThumbStatus(b,"Error"):(b.find(".kv-file-upload").hide(),g.setThumbStatus(b,"Success"),g.updateStack(i,void 0)),void i++)}),g.initUploadSuccess(c)),g.showUploadError(c.error,f,"filebatchuploaderror"))},e=function(){g.setProgress(100),g.unlock(),g.initSuccessThumbs(),g.clearFileInput(),g.raise("filebatchuploadcomplete",[g.filestack,g.getExtraData()])},f=function(b,c,d){var e=g.getOutData(b),f=g.parseError(b,d);g.showUploadError(f,e,"filebatchuploaderror"),g.uploadFileCount=i-1,g.showPreview&&(g.getThumbs().each(function(){var b=a(this),c=b.attr("data-fileindex");b.removeClass("file-uploading"),void 0!==g.filestack[c]&&g.setThumbStatus(b,"Error")}),g.getThumbs().removeClass("file-uploading"),g.getThumbs(" .kv-file-upload").removeAttr("disabled"),g.getThumbs(" .kv-file-delete").removeAttr("disabled"))},a.each(h,function(a,b){S(h[a])||g.formdata.append(g.uploadFileAttr,b,g.filenames[a])}),g.ajaxSubmit(c,d,e,f))},uploadExtraOnly:function(){var a,b,c,d,e=this,f={};e.formdata=new FormData,e.abort(f)||(a=function(a){e.lock();var b=e.getOutData(a);e.raise("filebatchpreupload",[b]),e.setProgress(50),f.data=b,f.xhr=a,e.abort(f)&&(a.abort(),e.setProgress(100))},b=function(a,b,c){var d=e.getOutData(c,a);S(a)||S(a.error)?(e.raise("filebatchuploadsuccess",[d]),e.clearFileInput(),e.initUploadSuccess(a)):e.showUploadError(a.error,d,"filebatchuploaderror")},c=function(){e.setProgress(100),e.unlock(),e.clearFileInput(),e.raise("filebatchuploadcomplete",[e.filestack,e.getExtraData()])},d=function(a,b,c){var d=e.getOutData(a),g=e.parseError(a,c);f.data=d,e.showUploadError(g,d,"filebatchuploaderror")},e.ajaxSubmit(a,b,c,d))},upload:function(){var b,c,d,e=this,f=e.getFileStack().length,g={},h=!a.isEmptyObject(e.getExtraData());if(e.minFileCount>0&&e.getFileCount(f)<e.minFileCount)return void e.noFilesError(g);if(e.isUploadable&&!e.isDisabled&&(0!==f||h)){if(e.resetUpload(),e.$progress.removeClass("hide"),e.uploadCount=0,e.uploadStatus={},e.uploadLog=[],e.lock(),e.setProgress(2),0===f&&h)return void e.uploadExtraOnly();if(d=e.filestack.length,e.hasInitData=!1,e.uploadAsync){for(c=e.getOutData(),e.raise("filebatchpreupload",[c]),e.fileBatchCompleted=!1,e.uploadCache={content:[],config:[],tags:[],append:!0},e.uploadAsyncCount=e.getFileStack().length,b=0;d>b;b++)e.uploadCache.content[b]=null,e.uploadCache.config[b]=null,e.uploadCache.tags[b]=null;for(b=0;d>b;b++)void 0!==e.filestack[b]&&e.uploadSingle(b,e.filestack,!0)}else e.uploadBatch()}},initFileActions:function(){var b=this;b.showPreview&&(b.$preview.find(".kv-file-remove").each(function(){var c,f,g,h,i=a(this),j=i.closest(".file-preview-frame"),k=j.attr("id"),l=j.attr("data-fileindex");d(i,"click",function(){return h=b.raise("filepreremove",[k,l]),h!==!1&&b.validateMinCount()?(c=j.hasClass("file-preview-error"),b.cleanMemory(j),void j.fadeOut("slow",function(){b.updateStack(l,void 0),b.clearObjects(j),j.remove(),k&&c&&b.$errorContainer.find('li[data-file-id="'+k+'"]').fadeOut("fast",function(){a(this).remove(),b.errorsExist()||b.resetErrors()});var d=b.getFileStack(!0),h=d.length,i=e.count(b.id),m=b.showPreview&&b.$preview.find(".file-preview-frame").length;b.clearFileInput(),0!==h||0!==i||m?(f=i+h,g=f>1?b.getMsgSelected(f):d[0]?b.getFileNames()[0]:"",b.setCaption(g)):b.reset(),b.raise("fileremoved",[k,l])})):!1})}),b.$preview.find(".kv-file-upload").each(function(){var c=a(this);d(c,"click",function(){var a=c.closest(".file-preview-frame"),d=a.attr("data-fileindex");a.hasClass("file-preview-error")||b.uploadSingle(d,b.filestack,!1)})}))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},addError:function(a){var b=this,c=b.$errorContainer;a&&c.length&&(c.html(b.errorCloseButton+a),c.find(".kv-error-close").off("click").on("click",function(){c.fadeOut("slow")}))},resetErrors:function(a){var b=this,c=b.$errorContainer;b.isError=!1,b.$container.removeClass("has-error"),c.html(""),a?c.fadeOut("slow"):c.hide()},showFolderError:function(a){var b=this,c=b.$errorContainer;a&&(b.addError(b.msgFoldersNotAllowed.replace(/\{n}/g,a)),c.fadeIn(800),j(b.$container,"has-error"),b.raise("filefoldererror",[a]))},showUploadError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileuploaderror",g=b&&b.id?'<li data-file-id="'+b.id+'">'+a+"</li>":"<li>"+a+"</li>";return 0===e.find("ul").length?d.addError("<ul>"+g+"</ul>"):e.find("ul").append(g),e.fadeIn(800),d.raise(f,[b]),d.$container.removeClass("file-input-new"),j(d.$container,"has-error"),!0},showError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileerror";return b=b||{},b.reader=d.reader,d.addError(a),e.fadeIn(800),d.raise(f,[b]),d.isUploadable||d.clearFileInput(),d.$container.removeClass("file-input-new"),j(d.$container,"has-error"),d.$btnUpload.attr("disabled",!0),!0},errorHandler:function(a,b){var c=this,d=a.target.error;c.showError(d.code===d.NOT_FOUND_ERR?c.msgFileNotFound.replace("{name}",b):d.code===d.SECURITY_ERR?c.msgFileSecured.replace("{name}",b):d.code===d.NOT_READABLE_ERR?c.msgFileNotReadable.replace("{name}",b):d.code===d.ABORT_ERR?c.msgFilePreviewAborted.replace("{name}",b):c.msgFilePreviewError.replace("{name}",b))},parseFileType:function(a){var b,c,d,e,f=this;for(e=0;e<P.length;e+=1)if(d=P[e],b=U(d,f.fileTypeSettings)?f.fileTypeSettings[d]:R[d],c=b(a.type,a.name)?d:"",!S(c))return c;return"other"},previewDefault:function(b,c,d){if(this.showPreview){var e=this,f="",g=b?b.name:"",h=Z.createObjectURL(b),i=c.slice(c.lastIndexOf("-")+1),j=e.previewSettings.other||Q.other,k=e.renderFileFooter(b.name,j.width),l=e.parseFilePreviewIcon(e.getPreviewTemplate("other"),g);d===!0&&(e.isUploadable||(k+='<div class="file-other-error" title="'+e.fileActionSettings.indicatorErrorTitle+'">'+e.fileActionSettings.indicatorError+"</div>")),e.clearDefaultPreview(),e.$preview.append("\n"+l.replace(/\{previewId}/g,c).replace(/\{frameClass}/g,f).replace(/\{fileindex}/g,i).replace(/\{caption}/g,e.slug(b.name)).replace(/\{width}/g,j.width).replace(/\{height}/g,j.height).replace(/\{type}/g,b.type).replace(/\{data}/g,h).replace(/\{footer}/g,k)),d===!0&&e.isUploadable&&e.setThumbStatus(a("#"+c),"Error")}},previewFile:function(a,b,c,d,e){if(this.showPreview){var f,g,h,i=this,j=i.parseFileType(b),k=b?b.name:"",l=i.slug(k),m=i.allowedPreviewTypes,n=i.allowedPreviewMimeTypes,o=i.getPreviewTemplate(j),p=m&&m.indexOf(j)>=0,q=U(j,i.previewSettings)?i.previewSettings[j]:Q[j],r=n&&-1!==n.indexOf(b.type),s=i.renderFileFooter(l,q.width),t="",u=d.slice(d.lastIndexOf("-")+1);p||r?(o=i.parseFilePreviewIcon(o,k.split(".").pop()),"text"===j?(g=X(c.target.result),h="text-"+W(),f=o.replace(/\{zoom}/g,i.getLayoutTemplate("zoom")),t=i.getLayoutTemplate("modal").replace("{id}",h).replace(/\{title}/g,l).replace(/\{body}/g,g).replace(/\{heading}/g,i.msgZoomModalHeading),f=f.replace(/\{previewId}/g,d).replace(/\{caption}/g,l).replace(/\{width}/g,q.width).replace(/\{height}/g,q.height).replace(/\{frameClass}/g,"").replace(/\{zoomInd}/g,i.zoomIndicator).replace(/\{footer}/g,s).replace(/\{fileindex}/g,u).replace(/\{type}/g,b.type).replace(/\{zoomTitle}/g,i.msgZoomTitle).replace(/\{dialog}/g,"$('#"+h+"').modal('show')").replace(/\{data}/g,g)+t):f=o.replace(/\{previewId}/g,d).replace(/\{caption}/g,l).replace(/\{frameClass}/g,"").replace(/\{type}/g,b.type).replace(/\{fileindex}/g,u).replace(/\{width}/g,q.width).replace(/\{height}/g,q.height).replace(/\{footer}/g,s).replace(/\{data}/g,e),i.clearDefaultPreview(),i.$preview.append("\n"+f),i.validateImage(a,d,l,b.type)):i.previewDefault(b,d)}},slugDefault:function(a){return S(a)?"":a.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},readFiles:function(b){this.reader=new FileReader;var c,d=this,e=d.$element,f=d.$preview,g=d.reader,h=d.$previewContainer,i=d.$previewStatus,j=d.msgLoading,k=d.msgProgress,l=d.previewInitId,m=b.length,n=d.fileTypeSettings,o=d.filestack.length,p=function(e,f,g,h){var i=a.extend(d.getOutData({},{},b),{id:g,index:h}),j={id:g,index:h,file:f,files:b};return d.previewDefault(f,g,!0),d.isUploadable&&d.pushStack(void 0),setTimeout(c(h+1),100),d.initFileActions(),d.isUploadable?d.showUploadError(e,i):d.showError(e,j)};d.loadedImages=[],d.totalImagesCount=0,a.each(b,function(a,b){var c="image",e=U(c,d.fileTypeSettings)?d.fileTypeSettings[c]:R[c];e&&e(b.type)&&d.totalImagesCount++}),c=function(a){if(S(e.attr("multiple"))&&(m=1),a>=m)return d.isUploadable&&d.filestack.length>0?d.raise("filebatchselected",[d.getFileStack()]):d.raise("filebatchselected",[b]),h.removeClass("file-thumb-loading"),void i.html("");var q,r,s,t,u,v,w=o+a,x=l+"-"+w,y=b[a],z=d.slug(y.name),A=(y.size||0)/1e3,B="",C=Z.createObjectURL(y),D=0,E=d.allowedFileTypes,F=S(E)?"":E.join(", "),G=d.allowedFileExtensions,H=S(G)?"":G.join(", ");if(S(G)||(B=new RegExp("\\.("+G.join("|")+")$","i")),A=A.toFixed(2),d.maxFileSize>0&&A>d.maxFileSize)return t=d.msgSizeTooLarge.replace("{name}",z).replace("{size}",A).replace("{maxSize}",d.maxFileSize),void(d.isError=p(t,y,x,a));if(!S(E)&&T(E)){for(s=0;s<E.length;s+=1)u=E[s],r=n[u],v=void 0!==r&&r(y.type,z),D+=S(v)?0:v.length;if(0===D)return t=d.msgInvalidFileType.replace("{name}",z).replace("{types}",F),void(d.isError=p(t,y,x,a))}return 0!==D||S(G)||!T(G)||S(B)||(v=z.match(B),D+=S(v)?0:v.length,0!==D)?d.showPreview?(f.length>0&&void 0!==FileReader?(i.html(j.replace("{index}",a+1).replace("{files}",m)),h.addClass("file-thumb-loading"),g.onerror=function(a){d.errorHandler(a,z)},g.onload=function(b){d.previewFile(a,y,b,x,C),d.initFileActions()},g.onloadend=function(){t=k.replace("{index}",a+1).replace("{files}",m).replace("{percent}",50).replace("{name}",z),setTimeout(function(){i.html(t),d.updateFileDetails(m),c(a+1)},100),d.raise("fileloaded",[y,x,a,g])},g.onprogress=function(b){if(b.lengthComputable){var c=b.loaded/b.total*100,d=Math.ceil(c);t=k.replace("{index}",a+1).replace("{files}",m).replace("{percent}",d).replace("{name}",z),setTimeout(function(){i.html(t)},100)}},q=U("text",n)?n.text:R.text,q(y.type,z)?g.readAsText(y,d.textEncoding):g.readAsArrayBuffer(y)):(d.previewDefault(y,x),setTimeout(function(){c(a+1),d.updateFileDetails(m)},100),d.raise("fileloaded",[y,x,a,g])),void d.pushStack(y)):(d.pushStack(y),setTimeout(c(a+1),100),void d.raise("fileloaded",[y,x,a,g])):(t=d.msgInvalidFileExtension.replace("{name}",z).replace("{extensions}",H),void(d.isError=p(t,y,x,a)))},c(0),d.updateFileDetails(m,!1)},updateFileDetails:function(a){var b=this,c=b.$element,d=b.getFileStack(),f=c.val()||d.length&&d[0].name||"",g=b.slug(f),h=b.isUploadable?d.length:a,i=e.count(b.id)+h,j=h>1?b.getMsgSelected(i):g;b.isError?(b.$previewContainer.removeClass("file-thumb-loading"),b.$previewStatus.html(""),b.$captionContainer.find(".kv-caption-icon").hide()):b.showFileIcon(),b.setCaption(j,b.isError),b.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&b.raise("fileselect",[a,g]),e.count(b.id)&&b.initPreviewDeletes()},validateMinCount:function(){var a=this,b=a.isUploadable?a.getFileStack().length:a.$element.get(0).files.length;return a.validateInitialCount&&a.minFileCount>0&&a.getFileCount(b-1)<a.minFileCount?(a.noFilesError({}),!1):!0},getFileCount:function(a){var b=this,c=0;return b.validateInitialCount&&!b.overwriteInitial&&(c=e.count(b.id),a+=c),a},change:function(b){var c=this,d=c.$element;if(!c.isUploadable&&S(d.val())&&c.fileInputCleared)return void(c.fileInputCleared=!1);c.fileInputCleared=!1;var f,g,h,i,j,k,l=arguments.length>1,m=l?b.originalEvent.dataTransfer.files:d.get(0).files,n=S(d.attr("multiple")),o=0,p=0,q=c.filestack.length,r=c.isUploadable,s=n&&q>0,t=function(b,d,e,f){var g=a.extend(c.getOutData({},{},m),{id:e,index:f}),h={id:e,index:f,file:d,files:m};return c.isUploadable?c.showUploadError(b,g):c.showError(b,h)};if(c.reader=null,c.resetUpload(),c.hideFileIcon(),c.isUploadable&&c.$container.find(".file-drop-zone ."+c.dropZoneTitleClass).remove(),l)for(f=[];m[o];)i=m[o],i.type||i.size%4096!==0?f.push(i):p++,o++;else f=void 0===b.target.files?b.target&&b.target.value?[{name:b.target.value.replace(/^.+\\/,"")}]:[]:b.target.files;if(S(f)||0===f.length)return r||c.clear(),c.showFolderError(p),void c.raise("fileselectnone");if(c.resetErrors(),k=f.length,h=c.isUploadable?c.getFileStack().length+k:k,h=c.getFileCount(h),c.maxFileCount>0&&h>c.maxFileCount){if(!c.autoReplace||k>c.maxFileCount)return j=c.autoReplace&&k>c.maxFileCount?k:h,g=c.msgFilesTooMany.replace("{m}",c.maxFileCount).replace("{n}",j),c.isError=t(g,null,null,null),c.$captionContainer.find(".kv-caption-icon").hide(),c.setCaption("",!0),void c.$container.removeClass("file-input-new file-input-ajax-new");h>c.maxFileCount&&c.resetPreviewThumbs(r)}else!r||s?(c.resetPreviewThumbs(!1),s&&c.clearStack()):!r||0!==q||e.count(c.id)&&!c.overwriteInitial||c.resetPreviewThumbs(!0);c.isPreviewable?c.readFiles(f):c.updateFileDetails(1),c.showFolderError(p)},getFileName:function(a){return a&&a.name?this.slug(a.name):void 0},getFileNames:function(a){var b=this;return b.filenames.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},getFileStack:function(a){var b=this;return b.filestack.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},clearStack:function(){var a=this;a.filestack=[],a.filenames=[]},updateStack:function(a,b){var c=this;c.filestack[a]=b,c.filenames[a]=c.getFileName(b)},pushStack:function(a){var b=this;b.filestack.push(a),b.filenames.push(b.getFileName(a))},checkDimensions:function(a,b,c,d,e,f,g){var h,i,j,k,l=this,m="Small"===b?"min":"max",n=l[m+"Image"+f];!S(n)&&c.length&&(j=c[0],i="Width"===f?j.naturalWidth||j.width:j.naturalHeight||j.height,k="Small"===b?i>=n:n>=i,k||(h=l["msgImage"+f+b].replace("{name}",e).replace("{size}",n),l.showUploadError(h,g),l.setThumbStatus(d,"Error"),l.updateStack(a,null)))},validateImage:function(a,b,c,e){var f,g,h,i=this,j=i.$preview,k=j.find("#"+b),l=k.find("img");c=c||"Untitled",l.length&&d(l,"load",function(){g=k.width(),h=j.width(),g>h&&(l.css("width","100%"),k.css("width","97%")),f={ind:a,id:b},i.checkDimensions(a,"Small",l,k,c,"Width",f),i.checkDimensions(a,"Small",l,k,c,"Height",f),i.resizeImage||(i.checkDimensions(a,"Large",l,k,c,"Width",f),i.checkDimensions(a,"Large",l,k,c,"Height",f)),i.raise("fileimageloaded",[b]),i.loadedImages.push({ind:a,img:l,thumb:k,pid:b,typ:e}),i.validateAllImages(),Z.revokeObjectURL(l.attr("src"))})},validateAllImages:function(){var a,b,c,d,e,f,g,h=this,i={};if(h.loadedImages.length===h.totalImagesCount&&(h.raise("fileimagesloaded"),h.resizeImage)){for(g=h.isUploadable?h.showUploadError:h.showError,a=0;a<h.loadedImages.length;a++)b=h.loadedImages[a],c=b.img,d=b.thumb,e=b.pid,f=b.ind,i={id:e,index:f},h.getResizedImage(c[0],b.typ,e,f)||(g(h.msgImageResizeError,i,"fileimageresizeerror"),h.setThumbStatus(d,"Error"),h.updateStack(f,void 0));h.raise("fileimagesresized")}},getResizedImage:function(a,b,c,d){var e,f,g=this,h=a.naturalWidth,i=a.naturalHeight,j=1,k=g.maxImageWidth||h,l=g.maxImageHeight||i,m=h&&i,n=g.imageCanvas,o=g.imageCanvasContext;if(!m)return!1;if(h===k&&i===l)return!0;b=b||g.resizeDefaultImageType,e=h>k,f=i>l,j="width"===g.resizePreference?e?k/h:f?l/i:1:f?l/i:e?k/h:1,g.resetCanvas(),h*=j,i*=j,n.width=h,n.height=i;try{return o.drawImage(a,0,0,h,i),n.toBlob(function(a){g.raise("fileimageresized",[c,d]),g.filestack[d]=a},b,g.resizeQuality),!0}catch(p){return!1}},initCaption:function(){var a=this,b=a.initialCaption||"";return a.overwriteInitial||S(b)?(a.$caption.html(""),!1):(a.setCaption(b),!0)},setCaption:function(b,c){var d,e,f=this;if(c)d=a("<div>"+f.msgValidationError+"</div>").text(),e='<span class="'+f.msgValidationErrorClass+'">'+f.msgValidationErrorIcon+d+"</span>";else{if(S(b)||0===f.$caption.length)return;d=a("<div>"+b+"</div>").text(),e=f.getLayoutTemplate("icon")+d}f.$caption.html(e),f.$caption.attr("title",d),f.$captionContainer.find(".file-caption-ellipsis").attr("title",d)},initBrowse:function(a){var b=this;b.$btnFile=a.find(".btn-file"),b.$btnFile.append(b.$element)},createContainer:function(){var b=this,c=a(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(b.renderMain());return b.$element.before(c),b.initBrowse(c),c},refreshContainer:function(){var a=this,b=a.$container;b.before(a.$element),b.html(a.renderMain()),a.initBrowse(b)},renderMain:function(){var a=this,b=a.isUploadable&&a.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",c=a.showClose?a.getLayoutTemplate("close"):"",d=a.showPreview?a.getLayoutTemplate("preview").replace(/\{class}/g,a.previewClass).replace(/\{dropClass}/g,b):"",e=a.isDisabled?a.captionClass+" file-caption-disabled":a.captionClass,f=a.captionTemplate.replace(/\{class}/g,e+" kv-fileinput-caption");return a.mainTemplate.replace(/\{class}/g,a.mainClass).replace(/\{preview}/g,d).replace(/\{close}/g,c).replace(/\{caption}/g,f).replace(/\{upload}/g,a.renderButton("upload")).replace(/\{remove}/g,a.renderButton("remove")).replace(/\{cancel}/g,a.renderButton("cancel")).replace(/\{browse}/g,a.renderButton("browse"))},renderButton:function(a){var b=this,c=b.getLayoutTemplate("btnDefault"),d=b[a+"Class"],e=b[a+"Title"],f=b[a+"Icon"],g=b[a+"Label"],h=b.isDisabled?" disabled":"",i="button";switch(a){case"remove":if(!b.showRemove)return"";break;case"cancel":if(!b.showCancel)return"";d+=" hide";break;case"upload":if(!b.showUpload)return"";b.isUploadable&&!b.isDisabled?c=b.getLayoutTemplate("btnLink").replace("{href}",b.uploadUrl):i="submit";break;case"browse":c=b.getLayoutTemplate("btnBrowse");break;default:return""}return d+="browse"===a?" btn-file":" fileinput-"+a+" fileinput-"+a+"-button",S(g)||(g=' <span class="'+b.buttonLabelClass+'">'+g+"</span>"),c.replace("{type}",i).replace("{css}",d).replace("{title}",e).replace("{status}",h).replace("{icon}",f).replace("{label}",g)}},a.fn.fileinput=function(c){if(g()||b(9)){var d=Array.apply(null,arguments),e=[];switch(d.shift(),this.each(function(){var b,f=a(this),g=f.data("fileinput"),h="object"==typeof c&&c,i=h.language||f.data("language")||"en";g||(b=a.extend({},a.fn.fileinput.defaults),"en"===i||S(a.fn.fileinputLocales[i])||(b=a.extend(b,a.fn.fileinputLocales[i])),g=new $(this,a.extend(b,h,f.data())),f.data("fileinput",g)),"string"==typeof c&&e.push(g[c].apply(g,d))}),e.length){case 0:return this;case 1:return e[0];default:return e}}},a.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,autoReplace:!1,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:N,previewTemplates:O,allowedPreviewTypes:P,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewSettings:Q,fileTypeSettings:R,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-icon-4x",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>',browseClass:"btn btn-ol-twitter",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-ol-google-plus",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",maxFileSize:0,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",zoomIndicator:'<i class="glyphicon glyphicon-zoom-in"></i>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;</span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},a.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgZoomTitle:"View details",msgZoomModalHeading:"Detailed Preview",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgUploadAborted:"The file upload was aborted",msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",dropZoneTitle:"Drag & drop files here &hellip;"},a.extend(a.fn.fileinput.defaults,a.fn.fileinputLocales.en),a.fn.fileinput.Constructor=$,a(document).ready(function(){var b=a("input.file[type=file]");b.length&&b.fileinput()})}(window.jQuery);